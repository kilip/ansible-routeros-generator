bridge:
  versionAdded: 1.0.0
  package: bridge
  command: /interface bridge
  validated: true
  module:
    states: ["merged", "replaced", "overridden", "deleted"]
  documentations:
    short_description: Bridge Resource Module
    descriptions:
      - This modules manages configuration in submenu `/interface bridge`.
  generator:
    url: https://wiki.mikrotik.com/wiki/Manual:Interface/Bridge
    tableIndex: 0
  options:
    disabled:
      type: str
      choices: ["yes", "no"]
      default: "no"
  tests:
    fixtures:
      interface_bridge_export: |
        /interface bridge
        add comment="trunk bridge" name=br-trunk arp=reply-only
        add comment="wan bridge" name=br-wan arp=reply-only
    facts:
      asserts:
        - self.assertEqual(result[0]["name"], "br-trunk")
        - self.assertEqual(result[0]["comment"], "trunk bridge")
        - self.assertEqual(result[0]["vlan_filtering"], "no")
        - self.assertEqual(result[0]["arp"], "reply-only")
  examples:
    # merge
    - name: Merge configuration with device configuration
      title: Using Merged
      argument_spec:
        config:
          - name: br-wan
            comment: updated comment
          - name: br-trunk
            comment: updated comment
            vlan_filtering: True
        state: merged
      commands:
        - /interface bridge set [ find name=br-wan ] comment="updated comment" arp=enabled
        - /interface bridge set [ find name=br-trunk ] comment="updated comment" vlan-filtering=yes arp=enabled
      post: |
        /interface bridge
        add comment="trunk bridge" name=br-trunk vlan-filtering=yes arp=enabled
        add comment="wan bridge" name=br-wan arp=enabled

    # replaced
    - name: Replace device configuration
      title: Using Replaced
      argument_spec:
        config:
          - name: br-wan
            comment: replaced comment
          - name: br-trunk
            comment: replaced comment
        state: replaced
      commands:
        - /interface bridge set [ find name=br-wan ] arp=enabled
        - /interface bridge set [ find name=br-wan ] comment="replaced comment"
        - /interface bridge set [ find name=br-trunk ] arp=enabled
        - /interface bridge set [ find name=br-trunk ] comment="replaced comment"
      post: |
        /interface bridge
        add comment="replaced comment" name=br-trunk arp=enabled
        add comment="replaced comment" name=br-wan arp=enabled

    # overridden
    - name: Override bridge configuration
      title: Using Overridden
      argument_spec:
        config:
          - name: br-new
            comment: new bridge
        state: overridden
      commands:
        - /interface bridge remove [ find name=br-trunk ]
        - /interface bridge remove [ find name=br-wan ]
        - /interface bridge add name=br-new comment="new bridge"
        - /system script run ansible-remove-invalid
      post: |
        # All existing bridge will be removed and replaced with the new configuration.
        /interface bridge
        add comment="new bridge" name=br-new

    # deleted
    - name: Delete bridge
      title: Using deleted state
      argument_spec:
        config:
          - name: br-trunk
          - name: br-wan
        state: deleted
      commands:
        - /interface bridge remove [ find name=br-trunk ]
        - /interface bridge remove [ find name=br-wan ]
        - /system script run ansible-remove-invalid

      post: |
        # All existing bridge will be removed and replaced with the new configuration.
        # empty bridge config