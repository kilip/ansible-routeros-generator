interface:
  versionAdded: 1.0.0
  package: interface
  validated: true
  command: /interface
  generator:
    url: https://wiki.mikrotik.com/wiki/Manual:Interface
    tableIndex: 1
  documentations:
    short_description: Interface Resource Module
    descriptions:
      - This module manages the interface configuration of Mikrotik RouterOS network devices.
  module:
    supports: ["facts_verbose_mode"]
    states: ["merged"]
  options:
    disabled:
      type: str
      choices: ["yes", "no"]
      default: "no"
      description: Set interface disability.
  tests:
    fixtures:
      interface_export_verbose: |
        # sep/04/2020 07:20:39 by RouterOS 6.47.2
        # software id =
        #
        #
        #
        /interface ethernet
        set [ find default-name=ether1 ] comment="ether1 comment" mtu=1500
        set [ find default-name=ether2 ] comment="ether2 comment" disabled=yes
        /interface bridge
        add name=br-wan comment="wan bridge"
    facts:
      asserts:
        # result[0]
        - self.assertEqual(result[0]["name"],"ether1")
        - self.assertEqual(result[0]["comment"],"ether1 comment")
        - self.assertEqual(result[0]["type"],"ethernet")
        - self.assertEqual(result[0]["disabled"], "no")
        - self.assertEqual(result[0]["mtu"],1500)
        # result[1]
        - self.assertEqual(result[1]["name"],"ether2")
        - self.assertEqual(result[1]["comment"],"ether2 comment")
        - self.assertEqual(result[1]["type"],"ethernet")
        - self.assertEqual(result[1]["disabled"],"yes")
        # result[2]
        - self.assertEqual(result[2]["name"], "br-wan")
        - self.assertEqual(result[2]["comment"], "wan bridge")
        - self.assertEqual(result[2]["type"], "bridge")
  examples:
    - name: Merge configuration with device configuration  
      argument_spec:
        config:
          - name: ether1
            comment: ether1 updated
            mtu: 1000
          - name: ether2
            comment: ether2 updated
            mtu: 2000
            disabled: False
          - name: br-wan
            disabled: True
            mtu: 3000
            comment: br-wan updated
        state: merged
      commands:
        - /interface set [ find name=ether1 ] comment="ether1 updated" mtu=1000
        - /interface set [ find name=ether2 ] comment="ether2 updated" mtu=2000 disabled=no
        - /interface set [ find name=br-wan ] disabled=yes mtu=3000 comment="br-wan updated"
      title: Using Merged
      pre: |
        [admin@MikroTik] > /interface export
        # sep/04/2020 07:20:39 by RouterOS 6.47.2
        # software id =
        #
        #
        #
        /interface ethernet
        set [ find default-name=ether1 ] comment="ether1 comment" mtu=1500
        set [ find default-name=ether2 ] comment="ether2 comment" disabled=yes
        /interface bridge
        add name=br-wan comment="wan bridge"

      post: |
        [admin@MikroTik] > /interface export
        /interface ethernet
        set [ find default-name=ether1 ] comment="ether1 updated" mtu=1000
        set [ find default-name=ether2 ] comment="ether2 updated" mtu=2000
        /interface bridge
        add name=br-wan comment="br-wan updated" mtu=3000 disabled=yes
