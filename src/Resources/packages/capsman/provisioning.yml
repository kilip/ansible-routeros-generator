capsman_provisioning:
  versionAdded: 1.0.0
  validated: true
  package: capsman
  command: /caps-man provisioning
  generator:
    url: https://wiki.mikrotik.com/wiki/Manual:CAPsMAN
    tableIndex: 3
  documentations:
    short_description: CAPsMan Provisioning Module
    descriptions:
      - This modules manages CAPsMan Provisioning on Mikrotik RouterOS network devices
  module:
    keys: ["comment"]
  options:
    ip_address_ranges:
      type: str
      defaultIgnored: true
      choicesIgnored: true
    slave_configurations:
      type: list
      elements: str
  tests:
    fixtures:
      caps-man_provisioning_export: |
        /caps-man provisioning
        add comment=test
    facts:
      asserts:
        - self.assertEqual(result[0]["comment"], "test")
  examples:
    - title: Using merged state
      name: Merge with device configuration
      argument_spec:
        state: merged
        config:
          - comment: test
            action: create-disabled
          - comment: Olympus Wireless Network
            identity_regexp: "olympus-"
            master_configuration: olympus-network
            name_format: identity
            slave_configurations:
              - troy-network
              - gaia-network
            action: create-enabled
      commands:
        - /caps-man provisioning set [ find comment=test ] action=create-disabled
        - /caps-man provisioning add comment="Olympus Wireless Network" identity-regexp=olympus- master-configuration=olympus-network name-format=identity slave-configurations=troy-network,gaia-network action=create-enabled
      post: |
        /caps-man provisioning
        add comment=test action=create-disabled
        add comment="Olympus Wireless Network" \
            identity-regexp=olympus- \
            master-configuration=olympus-network \
            name-format=identity \
            slave-configurations=troy-network,gaia-network

    - title: Using deleted state
      name: Delete provisioning config
      argument_spec:
        state: deleted
        config:
          - comment: test
      commands:
        - /caps-man provisioning remove [ find comment=test ]
        - /system script run ansible-remove-invalid
      post: |
        # empty caps-man provisioning config
