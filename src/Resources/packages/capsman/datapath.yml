capsman_datapath:
  versionAdded: 1.0.0
  validated: true
  package: capsman
  command: /caps-man datapath
  generator:
    url: https://wiki.mikrotik.com/wiki/Manual:CAPsMAN
    tableIndex: 6
  documentations:
    short_description: CAPsMan DataPath Configuration Module
    descriptions:
      - This modules manages CAPsMan DataPath Configuration on Mikrotik RouterOS network devices
  options:
    name:
      type: str
      required: "True"
      description: Name for datapath
    comment:
      type: str
      description: Short description of the datapath
    arp:
      type: str
      default: enabled
      choices:
          - disabled
          - enabled
          - proxy-arp
          - reply-only
      description: |
          Address Resolution Protocol setting
          - `disabled` - the interface will not use ARP
          - `enabled` - the interface will use ARP
          - `proxy-arp` - the interface will use the ARP proxy feature
          - `reply-only` - the interface will only reply to requests originated from matching IP address/MAC address combinations which are entered as static entries in the L(IP/ARP,https://wiki.mikrotik.com/wiki/Manual:IP/ARP) table. Therefore for communications to be successful, a valid static entry must already exist.
    bridge:
        type: str
        description: |
            Bridge to which particular interface should be automatically added as port. Required only when local-forwarding is not used.
    bridge_cost:
        type: int
        description: |
            bridge port cost to use when adding as bridge port
    bridge_horizon:
        type: int
        description: |
            bridge horizon to use when adding as bridge port
    client_to_client_forwarding:
        type: str
        default: no
        choices:
            - yes
            - no
        description: |
            controls if client-to-client forwarding between wireless clients connected to interface should be allowed, in local forwarding mode this function is performed by CAP, otherwise it is performed by CAPsMAN
    interface_list:
        type: list
        elements: str
        description: interface list for this datapath
    l2mtu:
        type: str
        description: set Layer2 MTU size
    local_forwarding:
        type: str
        default: no
        choices:
            - yes
            - no
        description: |
            Controls forwarding mode. If disabled, all L2 and L3 data will be forwarded to CAPsMAN, and further forwarding decisions will be made only then.
            Note, if disabled, make sure that each CAP interface MAC Address that participates in the same broadcast domain is unique (including local MACs, like Bridge-MAC).
    mtu:
        type: str
        description: set MTU size
    openflow_switch:
        type: str
        description: |
            OpenFlow switch port (when enabled) to add interface to
    vlan_id:
        type: int
        description: |
            VLAN ID to assign to interface if vlan-mode enables use of VLAN tagging
    vlan_mode:
        type: str
        choices:
            - use-service-tag
            - use-tag
        description: |
            Enables and specifies the type of VLAN tag to be assigned to the interface (causes all received data to get tagged with VLAN tag and allows the interface to only send out data tagged with given tag)

  tests:
    fixtures:
      caps-man_datapath_export: |
        /caps-man datapath
        add name=test
    facts:
      asserts:
        - self.assertEqual(result[0]["name"], "test")

  examples:
    - title: Using Merged
      name: Merge with device configuration
      argument_spec:
        state: merged
        config:
          - name: test
            bridge: br-trunk
            arp: reply-only
          - name: new
            bridge: br-trunk
            arp: reply-only
      commands:
        - /caps-man datapath set [ find name=test ] bridge=br-trunk arp=reply-only
        - /caps-man datapath add name=new bridge=br-trunk arp=reply-only
      post: |
        /caps-man datapath
        add name=test bridge=br-trunk arp=reply-only
        add name=new bridge=br-trunk arp=reply-only